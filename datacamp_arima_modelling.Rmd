---
title: "DataCamp ARIMA modelling with R"
output: html_notebook
---

```{r setup}
library(astsa)
library(xts)
```

# Chapter 1 - Time Series Data and Models
## Data Play
```{r}
# View a detailed description of AirPassengers
help(AirPassengers)

# Plot AirPassengers
plot(AirPassengers)

# Plot the DJIA daily closings
plot(djia$Close)

# Plot the Southern Oscillation Index
plot(soi)

```


```{r}
x <- structure(c(2.98585655205678, -6.36156306015438, -0.145666562602756, 
4.92854725441929, 3.26256067874077, 3.65560612225845, 4.51900122995054, 
9.9375591802286, 11.7539783928385, 2.30907879037081, 4.45962301710052, 
-3.35904346172256, 3.12439088614776, 4.32351825317027, 3.38837687782408, 
-1.36903056921538, -5.12933621879492, 0.511641840264529, 6.11245416012272, 
15.3293318801919, 9.68733244982073, 9.862048911462, 15.9673598351404, 
16.3416571109335, 20.5944304893327, 20.2246319819279, 22.4164586465568, 
23.8750972023301, 19.2596400244773, 12.6268464857467, 3.42233259967017, 
7.8371258465176, 13.6312027570507, 17.474589914096, 15.2310402588642, 
17.7947339421215, 12.0920205219765, 10.4566378128717, 7.81266609180251, 
14.7825279279609, 11.1885386269428, 23.8849076851077, 30.7431976181173, 
33.8500183780929, 33.4493969986455, 27.2179126850414, 23.1116969965299, 
27.1605488118939, 20.3911074897883, 21.1011686432332, 19.1438114181787, 
20.0941311584321, 16.1905781899913, 13.7102297288396, 14.6144117881947, 
14.9335073277967, 29.1132741161801, 31.3781884831813, 32.782775827942, 
30.4110701036743, 28.2442361457107, 29.0585447406389, 35.978167118227, 
34.9491274521574, 38.2229552383754, 31.3179388743664, 29.1704230335678, 
22.3348719168004, 16.5422893092033, 23.9607703611072, 20.8017289150049, 
19.3039467185282, 19.1387465945795, 13.0404000850076, 9.88010610031959, 
3.25048641996155, -4.19918275968336, -7.96261887951415, -4.50832110077692, 
-6.28537309298301, -2.453039429316, -4.71189229586915, 1.63087943001715, 
1.19585488413767, 5.28308136470283, 5.15003385136906, 3.71997783281994, 
0.665767535707778, 2.73844990818281, 8.74697569473448, 8.22210384279624, 
18.6630378367503, 11.3842934343059, 10.3178776159715, 21.0907932861552, 
25.0415105886248, 24.7981872472299, 34.6863348581511, 26.3263898698205, 
23.3543299354265, 23.7711763445365, 22.7445201731626, 29.2033700584025, 
30.2059359639166, 36.2287817661407, 37.6517821756905, 36.3734520946451, 
39.8420336826598, 27.8230916645184, 26.5969242465203, 26.9148845029947, 
24.3731964473413, 28.5126535517625, 26.739853161707, 30.4022749061866, 
39.5915113840175, 44.8034176876466, 44.0989985096432, 40.2248378109593, 
42.9846438413467, 40.8307727387177, 42.4045572544804, 41.4260845087238, 
40.4590230678125, 27.9814920323464, 40.4636839412182, 44.3681208743147, 
47.9082060699671, 49.0735406446515, 48.4330911407975, 49.8923471198233, 
61.6028156029336, 63.6813631502583, 72.3463147717006, 71.1518228856843, 
74.7256546774624, 79.1934466603393, 83.1976401996233, 74.4918275498315, 
72.1000705971506, 66.120351522625, 63.7527248340468, 63.1479654017478, 
67.417261089181, 74.2574613019088, 68.8725838108863, 68.1952518797513, 
70.0591191906425, 71.8743748346346, 73.2481880850212, 79.2106749473025, 
78.5204092426412, 87.2619304205797, 87.7628450480815, 91.3675835934382, 
93.3274825072301, 97.504254712443, 103.356918248965, 94.6092720705367, 
91.3573197623244, 85.8709664902753, 86.2847330378707, 86.2251352199283, 
84.2667764881675, 86.9466083873841, 92.022907882358, 82.0011966402956, 
88.6785945544989, 85.36627182904, 88.964060154202, 96.0459180417365, 
96.2658498161687, 90.9595899932112, 88.4945105561441, 95.4932429930682, 
92.9189872987947, 88.7585900264417, 91.0783168574001, 92.4792494197995, 
93.5652846953568, 94.3455430070056, 87.987281849086, 88.7311283987608, 
102.629405717409, 96.4659503378519, 92.2194453380401, 91.9247368308595, 
84.9854898089214, 90.2584504097202, 82.2410142658206, 89.7112209211688, 
86.6857665855464, 85.9217926519558, 95.0792748009638, 95.0479326760265, 
101.239320925171, 99.3096603408147, 94.168250757035, 96.0312588684648, 
91.7768781200342, 91.128961566017, 95.5680938432807, 101.268885432496, 
100.359378748711, 103.854329642292, 97.5835851222764, 98.9271463460838, 
103.798955762867, 105.88300136058, 102.110340021668, 105.827635002309, 
107.929576099835, 101.840123481871, 107.226132157832, 106.481743597452, 
111.67187612185, 116.109931362102, 115.166113952304, 115.665732807398, 
115.818883246398, 120.278038272353, 118.683512065393, 109.159167471051, 
109.7436406454, 117.134806685618, 114.037878507479, 116.989565474952, 
113.598788153727, 111.965228712667, 114.191173922199, 108.210220541929, 
105.334547623372, 108.216897869749, 112.076051209829, 102.667198624731, 
112.186982323288, 113.277868052096, 112.41046278256, 103.101882428477, 
98.7301172733983, 103.98448264513, 97.909023550033, 104.897925351567, 
108.134951907217, 103.558783351871, 102.404266468378, 102.002836964846, 
100.361663390034, 97.9829451446551, 89.85093648322), .Tsp = c(1, 
250, 1), class = "ts")
y <- structure(c(1.07518756249073, -1.22327599410139, -0.806599653673531, 
2.20282477577039, -0.188051345426183, 0.909033063783164, -1.19703296977968, 
-0.69679348021142, 1.13850262389572, -3.75018583413456, 3.21406742843748, 
-3.41240947461533, -0.570689534364516, 2.46282194067545, 0.879674421546447, 
2.6470473281049, 3.34869833480272, 2.12744822252196, 1.49506352595759, 
-1.03427507453022, -0.21776028294073, 2.53292072074063, -0.333329780396364, 
-1.1313751552583, 3.42316779070228, -2.65733610857178, 2.34444684029824, 
5.10697066220724, 2.76107361140167, 0.287680615200394, -1.43330179393571, 
2.92355316417617, 0.132448617524324, 4.2032594308835, 0.153922115334461, 
-0.451704663931633, 5.29335753129472, 0.923860326380297, 6.37144744526138, 
6.87611457508749, 2.66171654382199, 4.12791655417279, 6.16970835225761, 
2.66191503091129, 2.35805844169998, 8.56257616595854, 3.63869121895854, 
3.0448781272737, 1.58671977867309, 5.21755267437688, 5.68885857771293, 
2.42149928347129, 3.67224959469346, 3.6326329954558, 4.45259829553121, 
5.3534817240477, 6.80803750743657, 5.51210347471307, 6.70577706686933, 
3.72619701928969, 9.61741975800682, 7.83674713197578, 5.17748706140877, 
5.88644942629021, 4.27339259096502, 12.016786637021, 5.08893043455686, 
6.28015935305929, 4.26516781864997, 4.16200651596232, 5.9200963694331, 
8.98421845027039, 13.7450120545899, 9.41670853069755, 8.91735750384955, 
7.54303857617252, 6.23257502483195, 9.27024492325986, 8.92339199159031, 
9.29957941296897, 6.57945183264237, 9.41890690770105, 8.90917668082948, 
10.9315809214805, 9.97334257808697, 7.81033967665718, 10.2368277081361, 
10.2899672187429, 8.68112845644715, 10.3146748249991, 6.72953178307759, 
12.7875834042335, 5.98798535924844, 9.33563667914871, 10.5408173553889, 
10.1421926157187, 10.260816760749, 9.04731255411189, 11.5868765432518, 
13.5886051547588, 9.46640966293287, 7.41574383547398, 11.0767211021841, 
14.2901258854106, 11.2511311702973, 11.6834563351283, 11.5153469644241, 
9.05425433877311, 11.5184939040598, 11.487819654566, 9.00808782271719, 
11.887606294156, 10.8353599165343, 8.4024706365943, 11.3757685918191, 
10.3381069286795, 10.4919061059218, 14.8334054971493, 11.6379999320468, 
12.1553404674081, 14.1938754837019, 13.2540689279858, 9.6846356414639, 
12.8065278333433, 14.3460916753729, 12.9815208853599, 11.5454179415035, 
12.7670555167415, 12.6850607486682, 11.4466830861152, 12.9778253922878, 
12.6478384648547, 15.6948913420632, 12.0762548497331, 12.1423209154934, 
13.440111457865, 15.3412998032792, 14.4367238917326, 13.8629918702964, 
13.1309320467899, 10.9892885893303, 12.3687867992182, 13.5125556133032, 
14.6779823859272, 15.2780662266, 15.5537823507064, 14.0693058036175, 
14.6665123628596, 15.6628383021112, 14.07352274911, 15.6187315332821, 
14.4781539659753, 15.2513532663325, 13.0109987354391, 11.4298329854735, 
20.1918172280505, 19.0592664127609, 16.7097950141196, 15.6342538821085, 
11.2168047504722, 18.6197625739643, 15.2306378508009, 17.6491091453343, 
16.8749004689579, 17.8477117288867, 15.4435019324949, 19.3253602927821, 
19.3205786734199, 15.1768458712934, 17.6433578174252, 13.9195612148449, 
20.6959821423064, 21.2887850809647, 16.4248784742402, 20.291545441328, 
17.4471969295119, 15.4036770011349, 18.6492853631094, 17.7710613325949, 
18.5901307386366, 18.5846869808758, 18.4995626383772, 20.1874499265721, 
21.1372713466003, 18.3647743147622, 19.7736576397871, 20.3994994381278, 
19.5494265723646, 19.2275078792822, 18.8668583189052, 20.7897725532482, 
22.0547996240719, 20.5807114406492, 19.3121523260149, 16.1878060965845, 
16.5706527142016, 18.1080214640335, 22.0923643490083, 22.4979468665117, 
19.8108664857914, 21.904918760393, 24.0603201314478, 20.8067510790852, 
23.1254888943797, 20.635416592059, 23.8614104364665, 17.8659578969118, 
20.3237515856015, 17.4633116900874, 19.1252647823175, 19.3220399909858, 
22.6845140566705, 21.8191934935979, 18.6206340781398, 24.9521287452704, 
21.9320847557502, 18.4696744083708, 19.5131504826055, 22.2925503147554, 
21.4381912253191, 25.9300749263433, 17.8538466083302, 20.7045674413206, 
22.3747099245438, 21.0982953845691, 25.717927307229, 19.8315068058337, 
27.542107451272, 20.7884625820793, 17.8303992847865, 23.0441161917238, 
21.0823163944273, 21.6647728327339, 24.2463646612132, 25.5072636942741, 
23.7694087518506, 25.680100719112, 22.9365492046739, 26.6748733715776, 
26.6338403481717, 24.3008707439415, 25.5075605707147, 26.2825317965571, 
23.9234764037918, 25.9378681290718, 26.9582112358102, 24.2887583018773, 
24.693855443147, 28.6157138223345, 26.6018625549749), .Tsp = c(1, 
250, 1), class = "ts")
# Plot detrended y (trend stationary)
plot(diff(y))

# Plot detrended x (random walk)
plot(diff(x))

```

## Detrending data
```{r}
# Plot globtemp and detrended globtemp
par(mfrow = c(2,1))
plot(globtemp) 
plot(diff(globtemp))

# Plot cmort and detrended cmort
par(mfrow = c(2,1))
plot(cmort)
plot(diff(cmort))

```

## Dealing with trend and heterscedasticity
```{r}
# astsa and xts are preloaded 

# Plot GNP series (gnp) and its growth rate
par(mfrow = c(2,1))
plot(gnp)
plot(diff(log(gnp)))


# Plot DJIA closings (djia$Close) and its returns
par(mfrow = c(2,1))
plot(djia$Close)
plot(diff(log(djia$Close)))

 
```

## Simulating ARIMA models
```{r}
# Generate and plot white noise
WN <- arima.sim(list(order=c(0, 0, 0)), n=200)
plot(WN)


# Generate and plot an MA(1) with parameter .9 
MA <- arima.sim(list(order = c(0, 0, 1), ma=0.9), n=200)
plot(MA)


# Generate and plot an AR(2) with parameters 1.5 and -.75
AR <- arima.sim(list(order=c(2, 0, 0), ar=c(1.5, -.75)), n=200)
plot(AR)

```

# Chapter 2 - Fitting ARMA Models


## Fitting an AR(1) model
```{r}
# Generate 100 observations from the AR(1) model
x <- arima.sim(model = list(order = c(1, 0, 0), ar = .9), n = 100) 

# Plot the generated data 
plot(x)

# Plot the sample P/ACF pair
acf2(x)

# Fit an AR(1) to the data and examine the t-table
sarima(x, p=1, d=0, q=0)

```

## Fitting an AR2 model
```{r}
# astsa is preloaded
x <- arima.sim(model = list(order = c(2, 0, 0), ar = c(1.5, -.75)), n = 200)

# Plot x
plot(x)

# Plot the sample P/ACF of x
acf2(x)

# Fit an AR(2) to the data and examine the t-table
sarima(x, 2, 0, 0)

```

## Fitting an MA(1) model
```{r}
# astsa is preloaded
#x <- arima.sim(model = list(order = c(0, 0, 1), ma = -.8), n = 100)
# Plot x
plot(x)

# Plot the sample P/ACF of x
acf2(x)

# Fit an MA(1) to the data and examine the t-table
sarima(x, 0, 0, 1)

```

## Fitting an ARMA model
```{r}
# astsa is preloaded
x <- arima.sim(model = list(order = c(2, 0, 1), ar = c(1, -.9), ma = .8), n = 250)

# Plot x
plot(x)

# Plot the sample P/ACF of x
acf2(x)

# Fit an ARMA(2,1) to the data and examine the t-table
sarima(x, 2, 0, 1)

```

## Model CHoice I
```{r}
dl_varve <- diff(log(varve))
# Fit an MA(1) to dl_varve.   
sarima(dl_varve, 0, 0, 1)


# Fit an MA(2) to dl_varve. Improvement?
sarima(dl_varve, 0, 0, 2)

# Fit an ARMA(1,1) to dl_varve. Improvement?
sarima(dl_varve, 1, 0, 1)

```

## Residual Analysis I
```{r}
# Fit an MA(1) to dl_varve. Examine the residuals  
sarima(dl_varve, 0, 0, 1)

# Fit an ARMA(1,1) to dl_varve. Examine the residuals
sarima(dl_varve, 1, 0, 1)


```

## ARMA Get In
```{r}
# Fit an MA(1) to dl_varve. Examine the residuals  
sarima(dl_varve, 0, 0, 1)

# Fit an ARMA(1,1) to dl_varve. Examine the residuals
sarima(dl_varve, 1, 0, 1)


```

# Chapter 3 - ARIMA Models

## ARIMA Plug and Play
```{r}
# Plot x
x <- arima.sim(model = list(order = c(1, 1, 0), ar = .9), n = 200)
plot(x)

# Plot the P/ACF pair of x
acf2(x)

# Plot the differenced data
plot(diff(x))

# Plot the P/ACF pair of the differenced data
acf2(diff(x))


```

## Simulated ARIMA
```{r}
x <- arima.sim(list(order=c(2, 1, 0), ar = c(1.5, -.75)), n=250) +1
# Plot sample P/ACF of differenced data and determine model
acf2(diff(x))


# Estimate parameters and examine output
sarima(x, 2, 1, 0)

```

## Global Warming
```{r}
# Plot the sample P/ACF pair of the differenced data 
acf2(diff(globtemp))

# Fit an ARIMA(1,1,1) model to globtemp
sarima(globtemp, 1, 1, 1)

# Fit an ARIMA(0,1,2) model to globtemp. Which model is better?
sarima(globtemp, 0, 1, 2)

```

## Simulated Overfitting
```{r}
x <- arima.sim(list(order=c(0, 1, 1), ma=0.9), n=250)

# Plot sample P/ACF pair of the differenced data
acf2(diff(x))

# Fit the first model, compare parameters, check diagnostics
sarima(x, 0, 1, 1)

# Fit the second model and compare fit
sarima(x, 0, 1, 2)


```

## Diagnostics - Global Temps
```{r}
# Fit ARIMA(0,1,2) to globtemp and check diagnostics  
sarima(globtemp, 0, 1, 2)

# Fit ARIMA(1,1,1) to globtemp and check diagnostics
sarima(globtemp, 1, 1, 1)

# Which is the better model?
"ARIMA(1,1,1)"

```

## Forecasting simulated ARIMA
```{r}
y <- arima.sim(list(order=c(1, 1, 0), ar= 0.9), n=120)
x <- window(y, end=100)
# Plot P/ACF pair of differenced data 
acf2(diff(x))

# Fit model - check t-table and diagnostics
sarima(x, 1, 1, 0)

# Forecast the data 20 time periods ahead
sarima.for(x, n.ahead = 20, p = 1, d = 1, q = 0) 
lines(y)  

```

## Forecasting global temps
```{r}
# Fit an ARIMA(0,1,2) to globtemp and check the fit
sarima(globtemp, 0, 1, 2)

# Forecast data 35 years into the future
 sarima.for(globtemp, n.ahead = 35, 0, 1, 2)

```


# Chapter 4 - Seasonal ARIMA


## Fitting a Pure Seasonal Model

```{r}
# Plot sample P/ACF to lag 60 and compare to the true values
acf2(x, max.lag = 60)

# Fit the seasonal model to x
sarima(x, p = 0, d = 0, q = 0, P = 1, D = 0, Q = 1, S = 12)

```

## Fit a mixed seasonal model
```{r}
# Plot sample P/ACF pair to lag 60 and compare to actual
acf2(x, max.lag=60)


# Fit the seasonal model to x
sarima(x, 0, 0, 1, 0, 0, 1, 12)

```

## Data Analysis - Unemployment I
```{r}
# Plot unemp 
plot(unemp)

# Difference your data and plot it
d_unemp <- diff(unemp)
plot(d_unemp)


# Seasonally difference d_unemp and plot it
dd_unemp <- diff(d_unemp, lag = 12)  
plot(dd_unemp)


```

## Data Analysis - Unemployment I
```{r}
# Plot P/ACF pair of fully differenced data to lag 60
dd_unemp <- diff(diff(unemp), lag = 12)
acf2(dd_unemp, max.lag=60)


# Fit an appropriate model
sarima(unemp, p=2, d=1, q=0, P=0, D=1, Q=1, S=12 )

```
## Data Analysis - Commodity Prices
```{r}
# Plot differenced chicken
plot(diff(chicken))

# Plot P/ACF pair of differenced data to lag 60
acf2(diff(chicken), max.lag = 60)

# Fit ARIMA(2,1,0) to chicken - not so good
sarima(chicken, 2, 1, 0)

# Fit SARIMA(2,1,0,1,0,0,12) to chicken - that works
sarima(chicken, 2, 1, 0, 1, 0, 0, 12)

```

## Data Analysis - Birth Rate
```{r}
# Plot P/ACF to lag 60 of differenced data
d_birth <- diff(birth)
acf2(d_birth, max.lag = 60)

# Plot P/ACF to lag 60 of seasonal differenced data
dd_birth <- diff(d_birth, lag = 12)
acf2(dd_birth, max.lag = 60)

# Fit SARIMA(0,1,1)x(0,1,1)_12. What happens?
sarima(birth, 0, 1, 1, 0, 1, 1, 12)

# Add AR term and conclude
sarima(birth, 1, 1, 1, 0, 1, 1, 12)

```

## Forecasting monthly unemployment
```{r}
# Fit your previous model to unemp and check the diagnostics
sarima(unemp, 2, 1, 0, 0, 1, 1, 12)

# Forecast the data 3 years into the future
sarima.for(unemp, 2, 1, 0, 0, 1, 1, 12, n.ahead=36)

```

## How hard is it to forecast future commodities prices
```{r}
# Fit the chicken model again and check diagnostics
sarima(chicken, 2, 1, 0, 1, 0, 0, 12)

# Forecast the chicken data 5 years into the future
sarima.for(chicken, 2, 1, 0, 1, 0, 0, 12, n.ahead=60)


```

